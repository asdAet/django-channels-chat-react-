# EchoChat

???????????? ?? **Django Channels + React (Vite)** ? ?????????? ? ?????????? ?????????, ????????? ? WebSocket?????????????.

## ???????????
- ????????? ??????? (?????? ??? ??????, ???????? ?????? ??? ??????????????)
- ????????? ??????? ?? slug ? ????????? ????????????
- ??????? ????????? + ?????????? ?? ???? (????????? ????? ????????????)
- ??????????????????: ???????????? ? ????? (????? ????????? ?? IP, heartbeat + TTL)
- ??????? ?????????????: ??????, ?? ????? (?? 1000 ????????), ???? ???????????
- ??????? ? ??????? ?? ????? ?? ??????
- Rate?limit ??? ??????????? ? ?????????
- ??????? Django (?????????? ??????????????/???????????/?????????, ?????????????? ???? ?????????)

## ????
- **Backend:** Django 4, Channels, Daphne
- **Frontend:** React + TypeScript, Vite
- **Infra:** Nginx, PostgreSQL, Redis, Docker Compose

## ????????? ???????
- `backend/` ? Django + Channels
- `frontend/` ? React ?????????
- `deploy/` ? Nginx ?????? ? ??????????????
- `docker-compose.prod.yml` ? production compose

## ??????? ????? (????????)

### Backend
```bash
cd backend
python -m venv venv
venv\Scripts\activate
# Linux/macOS
# source venv/bin/activate
pip install -r requirements.txt
python manage.py migrate
python manage.py runserver 0.0.0.0:8000
```

### Frontend
```bash
cd frontend
npm install
npm run dev
```

Vite ?????????? `/api` ? `/ws` ?? `http://localhost:8000`.

## ?????? ? Docker (production)

1) ?????? `.env` ?? ???? `example.env`:
```bash
cp example.env .env
# Windows
# copy example.env .env
```

2) ??????? ??????:
```bash
docker compose -f docker-compose.prod.yml up -d --build
```

### HTTPS
?????? ??????????? ?:
```
deploy/certs/fullchain.pem
deploy/certs/privkey.pem
```

> ?????? ???????? ??????? ???????? `DJANGO_UPLOAD_MAX_MB` ? `client_max_body_size` ? `deploy/nginx.conf`.

## ?????????? ?????????

???????????:
| ?????????? | ???????? |
| --- | --- |
| `DJANGO_SECRET_KEY` | ????????? ???? Django |
| `POSTGRES_PASSWORD` | ?????? PostgreSQL |
| `POSTGRES_DB` | ??? ?? |
| `POSTGRES_USER` | ???????????? ?? |

?????????????:
| ?????????? | ???????? |
| --- | --- |
| `DJANGO_ALLOWED_HOSTS` | ?????? ??????? ? IP |
| `DJANGO_CSRF_TRUSTED_ORIGINS` | ?????????? ????????? CSRF |
| `DJANGO_DEBUG` | ????? ??????? |
| `REDIS_URL` | Redis URL ??? Channels ? cache |
| `DATABASE_URL` | ???????????? `DJANGO_DB_*` |
| `DJANGO_RELAX_PASSWORDS` | ?????????? ??????? ?????? ? dev |
| `DJANGO_UPLOAD_MAX_MB` | ????? ???????? ?????? (??) |
| `PRESENCE_TTL` | TTL ?????????????? (???) |
| `PRESENCE_GRACE` | ???. ???? ?grace? (???) |
| `AUTH_RATE_LIMIT` | ????? ??????? ??????????? |
| `AUTH_RATE_WINDOW` | ???? ?????? ??????????? (???) |
| `CHAT_MESSAGE_MAX_LENGTH` | ???????????? ????? ????????? |
| `CHAT_MESSAGE_RATE_LIMIT` | ????? ????????? |
| `CHAT_MESSAGE_RATE_WINDOW` | ???? ?????? ????????? (???) |
| `CHAT_ROOM_SLUG_REGEX` | Regex ??? slug ??????? |

## API

### REST
- `GET /api/auth/csrf/`
- `GET /api/auth/session/`
- `POST /api/auth/login/`
- `POST /api/auth/register/`
- `GET /api/auth/password-rules/`
- `GET/POST /api/auth/profile/`
- `GET /api/auth/users/<username>/`
- `GET /api/chat/public-room/`
- `GET /api/chat/rooms/<slug>/`
- `GET /api/chat/rooms/<slug>/messages/?limit=&before=`

### WebSocket
- `ws://<host>/ws/chat/<room>/`
- `ws://<host>/ws/presence/`

## ???????
??????? ???????? ?? `/admin/`. ??? ??????? ????? ?????????????????:
```bash
python manage.py createsuperuser
```

## ????
? Django ???????? ??????????? ????:
- `is_staff`
- `is_superuser`

??????????? ????????? ?????? ?????? ??? `user.is_staff === true`.

## ????????
?? ???????.
